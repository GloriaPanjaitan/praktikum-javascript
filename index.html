<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List</title>

    <!-- Bootstrap v5.3 (pakai vendor kalau ada, ini contoh CDN) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <style>
      body {
        background-color: #f4f7fa;
        font-family: "Arial", sans-serif;
        padding-top: 50px;
      }
      .todo-card {
        border-radius: 15px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        background-color: white;
      }
      .todo-card-header {
        background-color: #007bff;
        color: white;
        text-align: center;
        padding: 20px;
        border-radius: 15px 15px 0 0;
      }
      .todo-input-group {
        margin-bottom: 20px;
      }
      .form-control {
        border-radius: 50px;
      }
      .btn-primary {
        border-radius: 50px;
        padding: 10px 30px;
      }
      .todo-list {
        margin-top: 20px;
        padding: 20px;
      }
      .todo-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 10px;
        padding: 12px 15px;
        margin-bottom: 10px;
        background-color: #f8f9fa;
        transition: background-color 0.3s ease;
      }
      .todo-item:hover {
        background-color: #f1f1f1;
      }
      .todo-actions button {
        margin-left: 10px;
      }
      .btn-sm {
        border-radius: 50px;
      }
      .filter-buttons button {
        margin-right: 10px;
        border-radius: 25px;
        padding: 8px 16px;
        font-size: 14px;
      }
      .search-bar {
        margin-bottom: 20px;
      }
      .badge-category {
        font-size: 0.85rem;
        padding: 6px 12px;
        border-radius: 25px;
        margin-left: 10px;
      }
      /* Efek drag SortableJS */
      .sortable-ghost {
        opacity: 0.4;
        background: #ffe082 !important;
      }
      .sortable-chosen {
        background: #90caf9 !important;
        transform: scale(1.02);
      }
      .sortable-drag {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="todo-card">
            <div class="todo-card-header">
              <h3>Todo List</h3>
            </div>

            <!-- Todo Form -->
            <div class="todo-card-body p-3">
              <form id="formData">
                <div class="todo-input-group">
                  <input
                    type="text"
                    class="form-control"
                    id="todoInput"
                    name="todo"
                    placeholder="Tulis todo baru..."
                    required
                  />
                </div>
                <div class="todo-input-group">
                  <select class="form-select" name="category" id="category">
                    <option value="Pribadi">Pribadi</option>
                    <option value="Pekerjaan">Pekerjaan</option>
                    <option value="Lainnya">Lainnya</option>
                  </select>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                  <i class="bi bi-plus"></i> Tambah Todo
                </button>
              </form>
            </div>

            <!-- Search & Filter -->
            <div class="search-bar p-3">
              <div class="d-flex justify-content-between align-items-center">
                <div class="filter-buttons">
                  <button
                    type="button"
                    class="btn btn-outline-warning btn-sm"
                    data-filter="all"
                  >
                    Semua
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-danger btn-sm"
                    data-filter="active"
                  >
                    Belum Selesai
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-success btn-sm"
                    data-filter="completed"
                  >
                    Selesai
                  </button>
                </div>
                <div class="d-flex">
                  <input
                    id="searchInput"
                    type="search"
                    class="form-control me-2"
                    placeholder="Cari todo..."
                  />
                  <button id="clearSearch" class="btn btn-outline-secondary">
                    &times;
                  </button>
                </div>
              </div>
            </div>

            <!-- Todo List -->
            <div class="todo-list" id="todoList"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <script>
      let todos = [];
      let currentFilter = "all";
      let currentSearch = "";

      const todoListEl = document.getElementById("todoList");
      const form = document.getElementById("formData");
      const filterButtons = document.querySelectorAll(".filter-buttons button");
      const searchInput = document.getElementById("searchInput");
      const clearSearchBtn = document.getElementById("clearSearch");

      function saveToStorage() {
        localStorage.setItem("todos", JSON.stringify(todos));
      }
      function loadFromStorage() {
        const stored = localStorage.getItem("todos");
        if (stored) todos = JSON.parse(stored);
      }

      function getVisibleTodos() {
        const filtered = todos.filter((item) => {
          if (currentFilter === "active") return !item.completed;
          if (currentFilter === "completed") return item.completed;
          return true;
        });
        if (!currentSearch.trim()) return filtered;
        const q = currentSearch.trim().toLowerCase();
        return filtered.filter((item) => item.todo.toLowerCase().includes(q));
      }

      function renderTodos() {
        todoListEl.innerHTML = "";
        const visible = getVisibleTodos();

        visible.forEach((item, visibleIndex) => {
          const realIndex = todos.indexOf(item);
          const todoItem = document.createElement("div");
          todoItem.className =
            "todo-item d-flex justify-content-between align-items-center";
          todoItem.dataset.index = realIndex;

          const contentDiv = document.createElement("div");
          contentDiv.className = "d-flex align-items-center";

          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.className = "form-check-input me-2";
          checkbox.checked = item.completed;
          checkbox.addEventListener("change", () => {
            item.completed = checkbox.checked;
            saveToStorage();
            renderTodos();
          });

          const label = document.createElement("label");
          label.className = "form-check-label";
          label.textContent = item.todo;
          if (item.completed) {
            label.style.textDecoration = "line-through";
            label.classList.add("text-muted");
          }

          const categoryLabel = document.createElement("span");
          categoryLabel.className = "badge bg-info badge-category ms-2";
          categoryLabel.textContent = item.category;

          contentDiv.appendChild(checkbox);
          contentDiv.appendChild(label);
          contentDiv.appendChild(categoryLabel);

          const actionsDiv = document.createElement("div");
          actionsDiv.className = "todo-actions d-flex align-items-center";

          const editBtn = document.createElement("button");
          editBtn.className = "btn btn-sm btn-outline-secondary";
          editBtn.innerHTML = '<i class="bi bi-pencil"></i>';
          editBtn.addEventListener("click", () => startEdit(realIndex));

          const delBtn = document.createElement("button");
          delBtn.className = "btn btn-sm btn-outline-danger";
          delBtn.innerHTML = '<i class="bi bi-trash"></i>';
          delBtn.addEventListener("click", () => {
            if (confirm("Hapus todo ini?")) {
              todos.splice(realIndex, 1);
              saveToStorage();
              renderTodos();
            }
          });

          actionsDiv.appendChild(editBtn);
          actionsDiv.appendChild(delBtn);

          todoItem.appendChild(contentDiv);
          todoItem.appendChild(actionsDiv);

          todoListEl.appendChild(todoItem);
        });

        if (visible.length === 0) {
          const emptyMessage = document.createElement("div");
          emptyMessage.className = "alert alert-info text-center";
          emptyMessage.textContent = "Tidak ada todo untuk ditampilkan.";
          todoListEl.appendChild(emptyMessage);
        }
      }

      // Add Todo with validation
      form.addEventListener("submit", (e) => {
        e.preventDefault();
        const todoInput = form.todo.value.trim();
        const categoryInput = form.category.value;
        
        // Check if todo already exists
        if (todos.some((todo) => todo.todo.toLowerCase() === todoInput.toLowerCase())) {
          alert("Todo yang sama sudah ada!");
          return;
        }
        
        if (!todoInput) {
          alert("Todo tidak boleh kosong!");
          return;
        }
        
        todos.unshift({
          todo: todoInput,
          completed: false,
          category: categoryInput,
        });
        form.todo.value = "";
        saveToStorage();
        renderTodos();
      });

      // Filters
      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          currentFilter = btn.dataset.filter;
          renderTodos();
        });
      });

      // Search
      searchInput.addEventListener("input", (e) => {
        currentSearch = e.target.value;
        renderTodos();
      });
      clearSearchBtn.addEventListener("click", () => {
        currentSearch = "";
        searchInput.value = "";
        renderTodos();
      });

      // Aktifkan SortableJS
      function enableSortable() {
        Sortable.create(todoListEl, {
          animation: 200,
          ghostClass: "sortable-ghost",
          chosenClass: "sortable-chosen",
          dragClass: "sortable-drag",
          onEnd: function (evt) {
            const oldIndex = evt.oldIndex;
            const newIndex = evt.newIndex;
            if (oldIndex !== newIndex) {
              const movedItem = todos.splice(oldIndex, 1)[0];
              todos.splice(newIndex, 0, movedItem);
              saveToStorage();
              renderTodos();
            }
          },
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        loadFromStorage();
        renderTodos();
        enableSortable();
      });

      // Edit Todo
      function startEdit(index) {
        const todoItem = todos[index];
        const label = todoItem.todo;

        // Convert the todo to an input
        const labelEl = document.querySelector(`[data-index="${index}"] .form-check-label`);
        const inputEl = document.createElement("input");
        inputEl.type = "text";
        inputEl.className = "form-control";
        inputEl.value = label;
        inputEl.addEventListener("blur", () => saveEdit(index, inputEl.value));
        inputEl.addEventListener("keydown", (e) => {
          if (e.key === "Enter") saveEdit(index, inputEl.value);
        });

        labelEl.replaceWith(inputEl);
        inputEl.focus();
      }

      function saveEdit(index, newTodo) {
        if (newTodo.trim() === "") return;
        todos[index].todo = newTodo.trim();
        saveToStorage();
        renderTodos();
      }
    </script>
  </body>
</html>
